"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};jQuery(function(){return MPSUM.init()});var MPSUM={};(function(a){MPSUM={timer:null,delay:500,init:function(){var a=this;this.__register_update_toggle_events(),this.__register_save_settings_event(),this.__register_bulk_actions_event(),this.__register_pagination_events(),this.__register_filter_link_events(),this.__register_logs_filter_event(),this.__register_excluded_user_event(),this.__register_force_updates_event(),this.__register_enable_logs_event(),this.__register_clear_logs_event(),this.__register_reset_options_event(),this.__register_advanced_tab_menu_events(),this.__register_log_search_event(),this.__register_multisite_get_plugins_list(),this.__register_multisite_get_themes_list(),this.__register_disable_admin_bar_options_event(),this.__register_enable_admin_bar_options_event(),this.__register_logs_expand_event(),window.onpopstate=function(b){a.__register_advanced_on_pop_state(b)},this.__register_advanced_on_pop_state({}),this.__register_on_resize()},__register_on_resize:function(){MPSUM.__advanced_section_move(),a(window).resize(function(){MPSUM.__advanced_section_move()})},__advanced_section_move:function(){768>=a(window).width()?a(".eum-advanced-settings-container:visible").insertAfter("div.active-menu").addClass("active"):a(".eum-advanced-settings-container:visible").appendTo("#eum-adv-settings").addClass("active")},__register_advanced_on_pop_state:function(){var b=wpAjax.unserialize(window.location.href);if("action"in b&&a(".eum-updated").delay(5e3).slideUp(2e3),"option"in b)a("*[data-menu_name=\""+b.option+"\"]").click();else{var c=a(a("*[data-menu_name]")[0]);c.trigger("click")}},render:function(a){this.__render_filter_links(a.views),this.__render_rows(a.rows),this.__render_headers(a.headers),this.__render_pagination_top(a.pagination.top),this.__render_pagination_bottom(a.pagination.bottom),this.__unblockUI(),this.init()},send_command:function(a,b,c,d){var e=!(4<arguments.length&&void 0!==arguments[4])||arguments[4];e&&this.__blockUI({css:{width:"300px",border:"none","border-radius":"10px",left:"calc(50% - 150px)",padding:"20px"},message:"<div style=\"margin: 8px; font-size:150%;\" class=\"eum_saving_popup\"><img src=\""+mpsum.logo+"\" height=\"80\" width=\"80\"><br>"+mpsum.working+"</div>"});var f={json_parse:!0,alert_on_error:!0,action:"eum_ajax",nonce:mpsum.eum_nonce,nonce_key:"eum_nonce",timeout:null,async:!0,type:"POST"};for(var g in"undefined"==typeof d&&(d={}),f)d.hasOwnProperty(g)||(d[g]=f[g]);var h={action:d.action,subaction:a,nonce:d.nonce,nonce_key:d.nonce_key};if(h[d.nonce_key]=d.nonce,"object"===("undefined"==typeof b?"undefined":_typeof(b)))for(var i in b)h[i]=b[i];else h.action_data=b;var j={type:d.type,url:ajaxurl,data:h,success:function(a,b){if(d.json_parse){var e;try{e=MPSUM.parse_json(a)}catch(b){return console.log(b),console.log(a),void(d.alert_on_error&&alert(mpsum.unexpected_response+" "+a))}"function"==typeof c&&c(e,b,a)}else"function"==typeof c&&c(a,b)},error:function(a,b,c){"function"==typeof d.error_callback?d.error_callback(a,b,c):(console.log("eum_send_command: error: "+b+"  ("+c+")"),console.log(a))},dataType:"text",async:d.async};null!=d.timeout&&(j.timeout=d.timeout),jQuery.ajax(j)},parse_json:function(a){try{var b=JSON.parse(a);return b}catch(b){console.log("EUM: Exception when trying to parse JSON (1) - will attempt to fix/re-parse"),console.log(a)}var c=a.indexOf("{"),d=a.lastIndexOf("}");if(-1<c&&-1<d){var e=a.slice(c,d+1);try{var f=JSON.parse(e);return console.log("EUM: JSON re-parse successful"),f}catch(b){console.log("EUM: Exception when trying to parse JSON (2) - will attempt to fix/re-parse based upon bracket counting");for(var g,h=c,i=0,j="",k=!1;(0<i||h==c)&&h<=d;)g=a.charAt(h),k||"{"!=g?k||"}"!=g?"\""==g&&"\\"!=j&&(k=!k):i--:i++,j=g,h++;console.log("Started at cursor="+c+", ended at cursor="+h+" with result following:"),console.log(a.substring(c,h));try{var l=JSON.parse(a.substring(c,h));return console.log("EUM: JSON re-parse successful"),l}catch(a){throw a}}}throw"EUM: could not parse the JSON"},gather_settings:function(b){var c="";return b="undefined"==typeof b?"string":b,c="object"===b?a("input, select").serializeJSON({checkboxUncheckedValue:"0",useIntKeysAsArrayIndex:!0}):a("input, select").serialize(),c},__get_data:function(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,d={},e=a("#current-page-selector"),f=null;null!==c&&(f=c.search.substring(1)),"pagination"===b?d.paged=this.__query(f,"paged"):"pagination_input"===b||"bulk"===b||"save_settings"===b?d.paged=parseInt(a("input[name=paged]").val())||"1":void 0,d.m=a("#filter-by-date").val(),d.status=a("#filter-by-success").val(),d.action_type=a("#filter-by-action").val(),d.type=a("#filter-by-type").val(),d.order=a("#filter-by-order").val(),d.data=this.gather_settings("string"),d.is_search=!1;var g=wpAjax.unserialize(window.location.href);return d.is_search?(d.tab=e.data("tab")||g.tab,d.view="search"):null===f?(d.tab=e.data("tab")||g.tab,d.view=e.data("view")||"all"):(d.tab=g.tab,d.view=this.__query(f,"view")||"all"),d},__query:function(a,b){for(var c,d=a.split("&"),e=0;e<d.length;e++)if(c=d[e].split("="),b===c[0])return c[1];return!1},__blockUI:function(){a.blockUI({css:{width:"300px",border:"none","border-radius":"10px",left:"calc(50% - 150px)",padding:"20px"},message:"<div style=\"margin: 8px; font-size:150%;\" class=\"eum_saving_popup\"><img src=\""+mpsum.logo+"\" height=\"80\" width=\"80\"><br>"+mpsum.working+"</div>"})},__unblockUI:function(){a(".wrap .fade").delay(6e3).fadeOut(2e3),a.unblockUI()},__register_update_toggle_events:function(){var b=this;a(".eum-toggle-button").unbind("click"),a(".eum-toggle-button").on("click",function(c){var d=wpAjax.unserialize(window.location.href),e=d.tab;if(c.preventDefault(),null!=e&&"general"!=e){var f=a(c.currentTarget),g=f.closest(".toggle-wrapper").find("input"),h=f.closest(".toggle-wrapper"),i=h.closest(".eum-"+e+"-name-actions").find("> div[class$=\"wrapper\"]:not(div.eum-"+e+"-wrapper)"),j=f.closest("tr");f.addClass("eum-active"),f.hasClass("eum-enabled")?(f.next().removeClass("eum-active"),g.prop("value","true"),h.hasClass("toggle-wrapper-"+e)&&j.hasClass("inactive")&&(j.removeClass("inactive").addClass("active"),a.each(i,function(b,c){a(c).find("input").prop("value",!1),a(c).find(".eum-disabled").addClass("eum-active"),a(c).find(".eum-enabled").removeClass("eum-active"),a(c).slideDown()}.bind(b)))):(h.hasClass("toggle-wrapper-"+e)&&(j.removeClass("active").addClass("inactive"),a.each(i,function(b,c){a(c).find("input").prop("value",!1),a(c).slideUp()}.bind(b))),f.prev().removeClass("eum-active"),g.prop("value","false"));var k=b.__get_data("save_settings");b.send_command("save_"+e+"_update_options_and_render",k,function(b){a(".subsubsub").replaceWith(b.views),setTimeout(function(){MPSUM.__unblockUI(),MPSUM.init()},2e3)})}})},__register_save_settings_event:function(){var b=this;a("#eum-save-settings").on("click",function(c){c.preventDefault(),c.stopImmediatePropagation();var d=b.__get_data("save_settings");b.send_command("save_"+d.tab+"_update_options_and_render",d,function(c){a(".subsubsub").replaceWith(c.views),b.__unblockUI(),b.init()})})},__register_bulk_actions_event:function(){var b=this;a(".wrap").on("click","#doaction, #doaction2",function(c){if(c.preventDefault(),c.stopImmediatePropagation(),0!==a("input:checked").length){var d=b.__get_data("bulk");b.send_command("bulk_action_"+d.tab+"_update_options_and_render",d,function(c){b.render(c),a("#bulk-action-selector-top, #bulk-action-selector-bottom").val("-1")})}})},__register_pagination_events:function(){var b=this;a(".tablenav-pages a").on("click",function(a){a.preventDefault();var c=b.__get_data("pagination",a.currentTarget);b.__get_tab_content_and_render(c)}),a("input[name=paged]").on("keyup",function(a){13===a.which&&a.preventDefault(),window.clearTimeout(b.timer),b.timer=window.setTimeout(function(){var a=b.__get_data("pagination_input");b.__get_tab_content_and_render(a)},b.delay)})},__register_filter_link_events:function(){var b=this;a(".subsubsub a").on("click",function(c){c.preventDefault(),c.stopImmediatePropagation(),a(".subsubsub a").removeClass("current"),a(c.currentTarget).addClass("current");var d=b.__get_data("filters",c.currentTarget);b.__get_tab_content_and_render(d)})},__register_logs_filter_event:function(){var b=this;a("#post-query-submit").on("click",function(a){a.preventDefault(),a.stopImmediatePropagation();var c=b.__get_data();b.__get_tab_content_and_render(c)}),a("#filter-by-date, #filter-by-success, #filter-by-action, #filter-by-type, #filter-by-order").on("change",function(a){a.preventDefault(),a.stopImmediatePropagation();var c=b.__get_data();b.__get_tab_content_and_render(c)})},__register_excluded_user_event:function(){var b=this;a("#save-excluded-users").on("click",function(c){c.preventDefault(),b.send_command("save_excluded_users",{data:b.gather_settings("string")},function(c){a("#result").css("display","block").html("<div class=\"updated\"><p>"+c+"</p></div>").delay(2e3).slideUp(2e3),b.__unblockUI()})})},__register_force_updates_event:function(){var b=this;a("#force-updates").on("click",function(c){c.preventDefault(),"function"==typeof updraft_backupnow_inpage_go&&1===a("#backup_force_updates:checked").length?updraft_backupnow_inpage_go(function(){a("#updraft-backupnow-inpage-modal").dialog("close"),b.__send_force_updates_request()},"themes,plugins,wpcore","autobackup",null):b.__send_force_updates_request()})},__send_force_updates_request:function(){var b=this,c=a("#footer-upgrade strong a").html();this.send_command("force_updates",{},function(d){a("#result").css("display","block").html("<div class=\"updated\"><p>"+d.message+"</p></div>").delay(5e3).slideUp(2e3),b.__unblockUI(),!0===d.ran_immediately?(0<d.update_data.counts.total?b.__update_notifications(d.update_data):b.__remove_update_notifications(d.update_data),"undefined"!=typeof c&&a("#footer-upgrade strong").html(c.substr(4)),a("#result").css("display","block").html("<div class=\"updated\"><p>"+d.message+"</p></div>").delay(5e3).slideUp(2e3)):(a("#result").css("display","block").html("<div class=\"updated\"><p>"+d.message+"</p></div>").delay(5e3).slideUp(2e3),setTimeout(function(){return location.reload()},6e4))})},__remove_update_notifications:function(){a("#wp-admin-bar-updates").remove(),a(".update-nag").remove(),a(".update-plugins").remove()},__update_notifications:function(b){a(".update-nag").remove(),a("#wp-admin-bar-updates").html(b.admin_bar_link),a("#menu-dashboard ul li:nth-child(3) a").html(b.updates_link),a("#menu-appearance a div:nth-child(3)").html(b.themes_link),a("#menu-plugins a div:nth-child(3)").html(b.plugins_link)},__register_enable_logs_event:function(){var b=this;a("#enable-logs").on("click",function(c){c.preventDefault(),b.send_command("enable_logs",{},function(c){a("#result").css("display","block").html("<div class=\"updated\"><p>"+c+"</p></div>").delay(5e3).slideUp(2e3),b.__unblockUI()})})},__register_clear_logs_event:function(){var b=this;a("#clear-logs").on("click",function(c){c.preventDefault(),b.send_command("clear_logs",{},function(c){a("#result").css("display","block").html("<div class=\"updated\"><p>"+c+"</p></div>").delay(5e3).slideUp(2e3);var d=a(".wp-list-table thead th").length;a("#the-list").html("<tr class=\"no-items\"><td class=\"colspanchange\" colspan=\""+d+"\">"+mpsum.logs_no_items+"</td></tr>"),a(".tablenav-pages").remove(),b.__unblockUI()})})},__register_reset_options_event:function(){var b=this;a("#reset-options").on("click",function(a){a.preventDefault(),b.send_command("reset_options",{},function(){var a=window.location.href;a+="&action=reset&option=reset-options",window.location.href=a})})},__register_disable_admin_bar_options_event:function(){var b=this;a("#adminbar").on("click","#disable-admin-bar",function(c){c.preventDefault(),b.send_command("disable_admin_bar",{},function(c){a("#result").css("display","block").html("<div class=\"updated\"><p>"+c.message+"</p></div>").delay(5e3).slideUp(2e3),a("#disable-admin-bar").val(mpsum.enable_admin_bar),a("#disable-admin-bar").attr("id","enable-admin-bar"),b.__unblockUI(),window.location.href=window.location.href})})},__register_enable_admin_bar_options_event:function(){var b=this;a("#adminbar").on("click","#enable-admin-bar",function(c){c.preventDefault(),b.send_command("enable_admin_bar",{},function(c){a("#result").css("display","block").html("<div class=\"updated\"><p>"+c.message+"</p></div>").delay(5e3).slideUp(2e3),a("#enable-admin-bar").val(mpsum.disable_admin_bar),a("#enable-admin-bar").attr("id","disable-admin-bar"),b.__unblockUI(),window.location.href=window.location.href})})},__render_filter_links:function(b){"undefined"!==b&&b.length&&a(".subsubsub").replaceWith(b)},__render_rows:function(b){"undefined"!==b&&b.length&&a("#the-list").html(b)},__render_headers:function(b){"undefined"!==b&&b.length&&a("thead tr, tfoot tr").html(b)},__render_pagination_top:function(b){"undefined"!==b&&0<b.length?a(".tablenav.top .tablenav-pages").html(a(b).html()):a(".tablenav.top .tablenav-pages").html("")},__render_pagination_bottom:function(b){"undefined"!==b&&0<b.length?a(".tablenav.bottom .tablenav-pages").html(a(b).html()):a(".tablenav.bottom .tablenav-pages").html("")},__get_tab_content_and_render:function(a){var b=this;this.send_command("update_"+a.tab+"_tab",a,function(a){b.render(a)})},__register_advanced_tab_menu_events:function(){a("#eum-adv-settings-menu div > div").on("click",function(b){var c=b.currentTarget.dataset.menu_name;a(".eum-advanced-settings-container:not("+c+")").hide(),a("#eum-adv-settings-menu div > div").removeClass("active-menu"),a(".eum-advanced-settings-container").removeClass("active"),a(b.currentTarget).addClass("active-menu"),a(".eum-advanced-settings-container."+c).css("display","block").addClass("active"),MPSUM.__advanced_section_move();var d=wpAjax.unserialize(window.location.href),e=""+location.protocol+"//"+(""+location.host+location.pathname),f=a(a("*[data-menu_name]")[0]),g=c;e+="?page="+d.page+"&tab="+d.tab,g!=f.data("menu_name")&&(e+="&option="+g),"action"in d&&"reset-options"==g&&(e+="&action="+d.action),window.location.href!=e&&history.pushState("",document.title,e)})},__register_multisite_get_plugins_list:function(){var b=this;a(".eum-list-plugins-action").on("click",function(c){c.preventDefault();var d=a(c.target),e=d.data("plugin-file");d.siblings(".eum-list-plugins").html("<img src=\""+mpsum.spinner+"\" alt=\"Loading...\" />"),b.send_command("get_multisite_installs_from_plugin",{data:{plugin_file:e}},function(a){d.siblings(".eum-list-plugins").html(a.message)},{},!1)})},__register_multisite_get_themes_list:function(){var b=this;a(".eum-list-themes-action").on("click",function(c){c.preventDefault();var d=a(c.target),e=d.data("theme-file");d.siblings(".eum-list-themes").html("<img src=\""+mpsum.spinner+"\" alt=\"Loading...\" />"),b.send_command("get_multisite_installs_from_theme",{data:{stylesheet:e}},function(a){d.siblings(".eum-list-themes").html("<div class=\"mpsum-message\">"+a.message+"</div>")},{},!1)})},__register_log_search_event:function(){var b=this;a("#log-query-search").on("click",function(c){c.preventDefault(),c.stopImmediatePropagation();var d=b.__get_data(),e=a("#eum-log-search").val().trim();return""==e?void b.__get_tab_content_and_render(d):void(d.is_search=!0,d.search_term=e,d.view="search",b.__get_tab_content_and_render(d))})},__register_logs_expand_event:function(){a(".eum-note-expand").on("click",function(b){b.preventDefault(),a(b.target).siblings("div").toggle()})}}})(jQuery);