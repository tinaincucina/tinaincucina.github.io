jQuery(document).ready(function(e){if(e("body").on("click","#wpdcom .wmu-upload-wrap",function(){e(".wpd-form-foot",e(this).parents(".wpd_comm_form")).slideDown(parseInt(wpdiscuzAjaxObj.enableDropAnimation)?500:0)}),e("body").on("change",".wmu-add-files",function(){var a=e(this),t=a.parents(".wpd_comm_form"),r=a[0].files?a[0].files:[];r.length&&function a(t,r,o){r.attr("data-uploading","true");var d=new FormData;d.append("action","wmuUploadFiles"),d.append("wmuAttachmentsData",e(".wmu-attachments-data",r).val()),d.append("uniqueId",r.find(".wpdiscuz_unique_id").val());var m=0;e.each(o,function(e,a){m+=a.size,d.append(wpdiscuzAjaxObj.wmuInput+"["+e+"]",a)}),m>parseInt(wpdiscuzAjaxObj.wmuMaxFileSize)?wpdiscuzAjaxObj.setCommentMessage(wpdiscuzAjaxObj.applyFilterOnPhrase(wpdiscuzAjaxObj.wmuPhraseMaxFileSize,"wmuPhraseMaxFileSize",t),"error",3e3):m>parseInt(wpdiscuzAjaxObj.wmuPostMaxSize)?wpdiscuzAjaxObj.setCommentMessage(wpdiscuzAjaxObj.applyFilterOnPhrase(wpdiscuzAjaxObj.wmuPhrasePostMaxSize,"wmuPhrasePostMaxSize",t),"error",3e3):wpdiscuzAjaxObj.getAjaxObj(!0,!0,d).done(function(a){var t,o;a.success?(e(".wmu-attached-data-info",r).remove(),e(".wmu-add-files",r).after(a.data.attachmentsHtml),a.data.tooltip&&e(".wmu-upload-wrap",r).attr("wpd-tooltip",a.data.tooltip),t=r,o=a,e.each(o.data.previewsData,function(a,r){e(".wmu-action-wrap .wmu-"+a+"-tab",t).html(""),e.each(r,function(r,o){var d=o.id,m="",i=o.fullname,n=o.shortname;a==wpdiscuzAjaxObj.wmuKeyImages?(m=o.url,n=""):a==wpdiscuzAjaxObj.wmuKeyVideos?m=wpdiscuzAjaxObj.wmuIconVideo:a==wpdiscuzAjaxObj.wmuKeyFiles&&(m=wpdiscuzAjaxObj.wmuIconFile);var s='<div class="wmu-preview [PREVIEW_TYPE_CLASS]" title="[PREVIEW_TITLE]" data-wmu-type="[PREVIEW_TYPE]" data-wmu-attachment="[PREVIEW_ID]"><div class="wmu-preview-remove"><img class="wmu-preview-img" src="[PREVIEW_ICON]"><div class="wmu-file-name">[PREVIEW_FILENAME]</div><div class="wmu-delete">&nbsp;</div></div></div>';s=(s=(s=(s=(s=(s=s.replace("[PREVIEW_TYPE_CLASS]","wmu-preview-"+a)).replace("[PREVIEW_TITLE]",i)).replace("[PREVIEW_TYPE]",a)).replace("[PREVIEW_ID]",d)).replace("[PREVIEW_ICON]",m)).replace("[PREVIEW_FILENAME]",n),e(".wmu-action-wrap .wmu-"+a+"-tab",t).removeClass("wmu-hide").append(s)})}),a.data.errors&&(wpdiscuzAjaxObj.setCommentMessage(a.data.errors,"error",3e3),console.log(a.data.errors))):a.data.errorCode?wpdiscuzAjaxObj.setCommentMessage(wpdiscuzAjaxObj.applyFilterOnPhrase(wpdiscuzAjaxObj[a.data.errorCode],a.data.errorCode,r),"error",3e3):a.data.error&&wpdiscuzAjaxObj.setCommentMessage(a.data.error,"error",3e3),e("#wpdiscuz-loading-bar").fadeOut(250),r.attr("data-uploading","false")}).fail(function(a,t,o){console.log(o),e("#wpdiscuz-loading-bar").fadeOut(250),r.attr("data-uploading","false")})}(a,t,r)}),e("body").on("click",".wmu-attachment-delete",function(a){if(confirm(wpdiscuzAjaxObj.wmuPhraseConfirmDelete)){var t=e(this),r=t.data("wmu-attachment"),o=new FormData;o.append("action","wmuDeleteAttachment"),o.append("attachmentId",r),wpdiscuzAjaxObj.getAjaxObj(!0,!0,o).done(function(a){if(a.success){var r=t.parents(".wmu-comment-attachments");t.parent(".wmu-attachment").remove(),e(".wmu-attached-images *",r).length||e(".wmu-attached-images",r).remove(),e(".wmu-attached-videos *",r).length||e(".wmu-attached-videos",r).remove(),e(".wmu-attached-files *",r).length||e(".wmu-attached-files",r).remove()}else a.data.errorCode?wpdiscuzAjaxObj.setCommentMessage(wpdiscuzAjaxObj.applyFilterOnPhrase(wpdiscuzAjaxObj[a.data.errorCode],a.data.errorCode,r),"error",3e3):a.data.error&&wpdiscuzAjaxObj.setCommentMessage(a.data.error,"error",3e3);e("#wpdiscuz-loading-bar").fadeOut(250)}).fail(function(a,t,r){console.log(r),e("#wpdiscuz-loading-bar").fadeOut(250)})}else console.log("canceled")}),e("body").on("click",".wmu-preview",function(){var a=e(this),t=a.parents(".wpd_comm_form");a.data("wmu-type");var r=a.data("wmu-attachment"),o=new FormData;o.append("action","wmuRemoveAttachmentPreview"),o.append("attachmentId",r),o.append("wmuAttachmentsData",e(".wmu-attachments-data",t).val()),o.append("uniqueId",t.find(".wpdiscuz_unique_id").val()),wpdiscuzAjaxObj.getAjaxObj(!0,!0,o).done(function(r){if(r.success){a.remove();var o=e(".wmu-tabs",t);e.each(o,function(a,t){e(".wmu-preview",t).length?e(t).removeClass("wmu-hide"):e(t).addClass("wmu-hide")}),e(".wmu-attached-data-info",t).remove(),e(".wmu-add-files",t).after(r.data.attachmentsHtml),r.data.tooltip&&e(".wmu-upload-wrap",t).attr("wpd-tooltip",r.data.tooltip)}else r.data.errorCode?wpdiscuzAjaxObj.setCommentMessage(wpdiscuzAjaxObj.applyFilterOnPhrase(wpdiscuzAjaxObj[r.data.errorCode],r.data.errorCode,t),"error",3e3):r.data.error&&wpdiscuzAjaxObj.setCommentMessage(r.data.error,"error",3e3);e("#wpdiscuz-loading-bar").fadeOut(250)}).fail(function(a,t,r){console.log(r),e("#wpdiscuz-loading-bar").fadeOut(250)})}),parseInt(wpdiscuzAjaxObj.wmuIsLightbox)){function a(){e(".wmu-lightbox").colorbox({maxHeight:"95%",maxWidth:"95%",rel:"wmu-lightbox",fixed:!0})}a(),wpdiscuzAjaxObj.wmuAddLightBox=a}wpdiscuzAjaxObj.wmuHideAll=function(a,t){"object"==typeof a?a.success?(e(".wmu-tabs",t).addClass("wmu-hide"),e(".wmu-preview",t).remove(),e(".wmu-attached-data-info",t).remove()):console.log(a.data):console.log(a)}});